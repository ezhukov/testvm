- name: install {{ pkg }} build-dependencies
  shell: yes | mk-build-deps -ir "{{ pkg }}"

- name: check if {{ pkg }} folder exists
  stat:
    path: "{{ pkg }}"
  register: pkg_folder

- name: debcheckout {{ pkg }}
  command: debcheckout "{{ pkg }}"
  when: not pkg_folder.stat.exists

- name: build {{ pkg }}
  command: dpkg-buildpackage -uc -us -b
  args:
    chdir: "{{ pkg }}"

- name: remove {{ pkg }} build dependencies
  apt:
    state: absent
    name: "{{ pkg }}-build-deps"
    autoremove: yes
